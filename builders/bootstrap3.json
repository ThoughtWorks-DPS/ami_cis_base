{
  "variables": {
			"region": "us-east-1",
			"buildtime": "{{ isotime \"2006-01-02-1504\" }}"
	},
	"builders": [{
		"type": "amazon-ebs",
		"region": "{{ user `region` }}",
		"spot_price_auto_product": "Linux/UNIX (Amazon VPC)",
		"source_ami": "ami-a41e65b2",
		"instance_type": "t2.micro",
		"ssh_username": "ubuntu",
		"ami_name": "cis-unbuntu-16.04-{{timestamp}}",
		"ssh_keypair_name": "rchawla-bootstrap",
		"ssh_private_key_file": "/Users/ranbir/.ssh/rchawla-bootstrap",
		"run_tags": {
				"Name": "Packer Builder - cis-unbuntu-16.04",
				"Project": "di-bootstrap",
				"creator": "{{ user `creator` }}"
		},
		"run_volume_tags": {
				"Name": "Packer Builder - cis-unbuntu-16.04",
				"Project": "di-bootstrap",
				"creator": "{{ user `creator` }}"
		},
		"tags": {
				"Name": "cis-unbuntu-16.04-{{timestamp}}",
				"BuildTime": "{{ user `buildtime` }}",
				"creator": "{{ user `creator` }}"
		},
		"ami_block_device_mappings": [{
			"device_name": "/dev/sda1",
			"volume_size": 30,
			"volume_type": "gp2",
			"delete_on_termination": true
		}],
		"launch_block_device_mappings": [{
			"device_name": "/dev/sda1",
			"volume_size": 30,
			"volume_type": "gp2",
			"delete_on_termination": true
		}]
	}],
	"provisioners": [
    {
      "type": "shell",
      "remote_folder":"/home/ubuntu",
      "inline": [
        "while [ ! -f /var/lib/cloud/instance/boot-finished ]; do echo 'Waiting for cloud-init...'; sleep 1; done"
      ]
    },
    {
      "type": "shell",
      "remote_folder": "/home/ubuntu",
      "script": "builders/remove-old-dirs.sh"
    },
		{
			"type": "ansible",
			"playbook_file": "../provision.yml",
      "user": "ubuntu"
		}
	],
	"post-processors": [{
		"type": "manifest",
		"output": "bootstrap3-manifest.json",
		"strip_path": true
	}]
}
